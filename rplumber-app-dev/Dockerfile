#FROM trestletech/plumber
FROM rocker/r-base:3.6.3
MAINTAINER Carey King <careyking@mail.utexas.edu>

RUN apt-get update -qq && apt-get install -y \
  git-core \
  libssl-dev \
  libcurl4-gnutls-dev

## RUN R -e 'install.packages(c("devtools"))'
## RUN R -e 'devtools::install_github("trestletech/plumber")'
RUN install2.r plumber

EXPOSE 8000
ENTRYPOINT ["R", "-e", "pr <- plumber::plumb(commandArgs()[4]); pr$run(host='0.0.0.0', port=8000)"]
CMD ["/usr/local/lib/R/site-library/plumber/examples/04-mean-sum/plumber.R"]


RUN apt update --allow-releaseinfo-change
##RUN apt install -y libc6-dev
RUN apt install -y gcc-8-base
RUN apt install -y libgcc-8-dev
RUN apt install -y libcurl4-openssl-dev libxml2 libxml2-dev


# add filepath to R source packages
ADD ./R_packages_static /R_packages_static

# install static packages THESE ARE IN ORDER, DO NOT CHANGE ORDER

RUN R -e "install.packages(c('R_packages_static/yaml_2.2.1.tar.gz','R_packages_static/xml2_1.3.2.tar.gz','R_packages_static/XML_3.99-0.3.tar.gz','R_packages_static/xfun_0.13.tar.gz','R_packages_static/withr_2.2.0.tar.gz','R_packages_static/whisker_0.4.tar.gz','R_packages_static/viridisLite_0.3.0.tar.gz','R_packages_static/gtable_0.3.0.tar.gz','R_packages_static/gridExtra_2.3.tar.gz','R_packages_static/rlang_0.4.6.tar.gz','R_packages_static/glue_1.4.1.tar.gz','R_packages_static/digest_0.6.25.tar.gz','R_packages_static/ellipsis_0.3.0.tar.gz','R_packages_static/vctrs_0.3.0.tar.gz','R_packages_static/pkgconfig_2.0.3.tar.gz','R_packages_static/utf8_1.1.4.tar.gz','R_packages_static/fansi_0.4.1.tar.gz','R_packages_static/crayon_1.3.4.tar.gz','R_packages_static/assertthat_0.2.1.tar.gz','R_packages_static/cli_2.0.2.tar.gz','R_packages_static/pillar_1.4.4.tar.gz','R_packages_static/magrittr_1.5.tar.gz','R_packages_static/lifecycle_0.2.0.tar.gz','R_packages_static/tibble_3.0.1.tar.gz','R_packages_static/RColorBrewer_1.1-2.tar.gz','R_packages_static/R6_2.4.1.tar.gz','R_packages_static/colorspace_1.4-1.tar.gz','R_packages_static/munsell_0.5.0.tar.gz','R_packages_static/labeling_0.3.tar.gz','R_packages_static/farver_2.0.3.tar.gz','R_packages_static/scales_1.1.1.tar.gz','R_packages_static/praise_1.0.0.tar.gz','R_packages_static/rstudioapi_0.11.tar.gz','R_packages_static/backports_1.1.7.tar.gz','R_packages_static/rprojroot_1.3-2.tar.gz','R_packages_static/prettyunits_1.1.1.tar.gz','R_packages_static/desc_1.2.0.tar.gz','R_packages_static/ps_1.3.3.tar.gz','R_packages_static/processx_3.4.2.tar.gz','R_packages_static/callr_3.4.3.tar.gz','R_packages_static/pkgbuild_1.0.8.tar.gz','R_packages_static/pkgload_1.0.2.tar.gz','R_packages_static/evaluate_0.14.tar.gz','R_packages_static/testthat_2.3.2.tar.gz','R_packages_static/Rcpp_1.0.4.6.tar.gz','R_packages_static/isoband_0.2.1.tar.gz','R_packages_static/ggplot2_3.3.0.tar.gz','R_packages_static/viridis_0.5.1.tar.gz','R_packages_static/uuid_0.1-4.tar.gz','R_packages_static/tweenr_1.0.1.tar.gz','R_packages_static/purrr_0.3.4.tar.gz','R_packages_static/tidyselect_1.1.0.tar.gz','R_packages_static/stringi_1.4.6.tar.gz','R_packages_static/plogr_0.2.0.tar.gz','R_packages_static/BH_1.72.0-3.tar.gz','R_packages_static/dplyr_0.8.5.tar.gz','R_packages_static/tidyr_1.0.3.tar.gz','R_packages_static/igraph_1.2.5.tar.gz','R_packages_static/tidygraph_1.2.0.tar.gz','R_packages_static/sys_3.3.tar.gz','R_packages_static/survival_3.1-12.tar.gz','R_packages_static/stringdist_0.9.5.5.tar.gz','R_packages_static/sp_1.4-1.tar.gz','R_packages_static/setRNG_2013.9-1.tar.gz','R_packages_static/numDeriv_2016.8-1.1.tar.gz','R_packages_static/optextras_2019-12.4.tar.gz','R_packages_static/Rvmmin_2018-4.17.tar.gz','R_packages_static/rpart_4.1-15.tar.gz','R_packages_static/data.table_1.12.8.tar.gz','R_packages_static/jsonlite_1.6.1.tar.gz','R_packages_static/rlist_0.4.6.1.tar.gz','R_packages_static/rjson_0.2.20.tar.gz','R_packages_static/stringr_1.4.0.tar.gz','R_packages_static/plyr_1.8.6.tar.gz','R_packages_static/reshape2_1.4.4.tar.gz','R_packages_static/remotes_2.1.1.tar.gz','R_packages_static/rematch2_2.1.2.tar.gz','R_packages_static/rematch_1.0.1.tar.gz','R_packages_static/clipr_0.7.0.tar.gz','R_packages_static/hms_0.5.3.tar.gz','R_packages_static/readr_1.3.1.tar.gz','R_packages_static/RcppEigen_0.3.3.7.0.tar.gz','R_packages_static/RcppArmadillo_0.9.870.2.0.tar.gz','R_packages_static/Rcgmin_2013-2.21.tar.gz','R_packages_static/R.methodsS3_1.8.0.tar.gz','R_packages_static/R.oo_1.23.0.tar.gz','R_packages_static/R.utils_2.9.2.tar.gz','R_packages_static/graphlayouts_0.7.0.tar.gz','R_packages_static/ggrepel_0.8.2.tar.gz','R_packages_static/polyclip_1.10-0.tar.gz','R_packages_static/ggforce_0.3.1.tar.gz','R_packages_static/ggraph_2.0.2.tar.gz','R_packages_static/abind_1.4-5.tar.gz','R_packages_static/pbapply_1.4-2.tar.gz','R_packages_static/BDgraph_2.62.tar.gz','R_packages_static/gtools_3.8.2.tar.gz','R_packages_static/d3Network_0.5.2.1.tar.gz','R_packages_static/fdrtool_1.2.15.tar.gz','R_packages_static/huge_1.3.4.1.tar.gz','R_packages_static/glasso_1.11.tar.gz','R_packages_static/corpcor_1.6.9.tar.gz','R_packages_static/png_0.1-7.tar.gz','R_packages_static/jpeg_0.1-8.1.tar.gz','R_packages_static/base64enc_0.1-3.tar.gz','R_packages_static/htmltools_0.4.0.tar.gz','R_packages_static/htmlwidgets_1.5.1.tar.gz','R_packages_static/checkmate_2.0.0.tar.gz','R_packages_static/mime_0.9.tar.gz','R_packages_static/markdown_1.1.tar.gz','R_packages_static/highr_0.8.tar.gz','R_packages_static/knitr_1.28.tar.gz','R_packages_static/htmlTable_1.13.3.tar.gz','R_packages_static/acepack_1.4.1.tar.gz','R_packages_static/latticeExtra_0.6-29.tar.gz','R_packages_static/Formula_1.2-3.tar.gz','R_packages_static/Hmisc_4.4-0.tar.gz','R_packages_static/pbivnorm_0.6.0.tar.gz','R_packages_static/mnormt_1.5-7.tar.gz','R_packages_static/lavaan_0.6-6.tar.gz','R_packages_static/psych_1.9.12.31.tar.gz','R_packages_static/qgraph_1.6.5.tar.gz','R_packages_static/optimr_2019-12.16.tar.gz','R_packages_static/askpass_1.1.tar.gz','R_packages_static/openssl_1.4.1.tar.gz','R_packages_static/nnet_7.3-14.tar.gz','R_packages_static/nlme_3.1-147.tar.gz','R_packages_static/networkD3_0.4.tar.gz','R_packages_static/mgcv_1.8-31.tar.gz','R_packages_static/matsbyname_0.4.14.tar.gz','R_packages_static/matsindf_0.3.4.tar.gz','R_packages_static/Matrix_1.2-18.tar.gz','R_packages_static/MASS_7.3-51.6.tar.gz','R_packages_static/generics_0.0.2.tar.gz','R_packages_static/lubridate_1.7.8.tar.gz','R_packages_static/lazyeval_0.2.2.tar.gz','R_packages_static/lattice_0.20-41.tar.gz','R_packages_static/ids_1.0.1.tar.gz','R_packages_static/curl_4.3.tar.gz','R_packages_static/httr_1.4.1.tar.gz','R_packages_static/fs_1.4.1.tar.gz','R_packages_static/gargle_0.5.0.tar.gz','R_packages_static/googledrive_1.0.1.tar.gz','R_packages_static/cellranger_1.1.0.tar.gz','R_packages_static/googlesheets4_0.2.0.tar.gz','R_packages_static/BiocGenerics_0.34.0.tar.gz','R_packages_static/graph_1.66.0.tar.gz','R_packages_static/ggm_2.5.tar.gz','R_packages_static/geosphere_1.5-10.tar.gz','R_packages_static/fuzzyjoin_0.1.5.tar.gz','R_packages_static/cluster_2.1.0.tar.gz','R_packages_static/zeallot_0.1.0.tar.gz','R_packages_static/Recca_0.1.18.tar.gz'), repos = NULL, type='source')"

#ADD ./data /data
ADD . /app
ADD ./master_R_scripts /scripts
CMD ["/app/plumber.R"]
